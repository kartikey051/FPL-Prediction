<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FPL Analytics Dashboard - Advanced Football Insights">
    <title>Dashboard | FPL Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* Table metric styling */
        .metric-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            display: block;
        }

        .metric-value {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .row-understat {
            border-left: 3px solid var(--accent-blue);
        }

        .cursor-pointer {
            cursor: pointer;
        }
    </style>
</head>

<body class="dashboard-page">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <span class="logo-icon">ðŸ“Š</span>
            <span class="logo-text">FPL Dashboard</span>
        </div>

        <ul class="sidebar-nav">
            <li class="nav-item active" data-view="overview">
                <a href="#overview" class="nav-link">
                    <i class="bi bi-grid-1x2-fill"></i>
                    <span>Overview</span>
                </a>
            </li>
            <li class="nav-item" data-view="trends">
                <a href="#trends" class="nav-link">
                    <i class="bi bi-graph-up"></i>
                    <span>Performance Trends</span>
                </a>
            </li>
            <li class="nav-item" data-view="discovery">
                <a href="#discovery" class="nav-link">
                    <i class="bi bi-search"></i>
                    <span>Player Discovery</span>
                </a>
            </li>
            <li class="nav-item" data-view="teams">
                <a href="#teams" class="nav-link">
                    <i class="bi bi-people-fill"></i>
                    <span>Squad Analytics</span>
                </a>
            </li>
            <li class="nav-item" data-view="standings">
                <a href="#standings" class="nav-link">
                    <i class="bi bi-list-ol"></i>
                    <span>Standings</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="user-info">
                <i class="bi bi-person-circle"></i>
                <span id="usernameDisplay">Analyst</span>
            </div>
            <button class="btn btn-outline-light btn-sm w-100 mt-2" id="logoutBtn">
                <i class="bi bi-box-arrow-right"></i> Logout
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
            <div class="header-left">
                <h1 id="viewTitle">Dashboard Overview</h1>
                <p class="text-muted mb-0" id="viewSubtitle">Premier League Performance Insights</p>
            </div>
            <div class="header-right d-flex gap-2 align-items-center">
                <span class="small text-muted">Season:</span>
                <select id="seasonFilter" class="form-select w-auto">
                    <option value="2024-25">2024-25</option>
                </select>
                <span class="small text-muted ms-2">Team:</span>
                <select id="teamFilter" class="form-select w-auto">
                    <option value="">League-wide</option>
                </select>
            </div>
        </header>

        <!-- Global Search Bar (Only in Discovery) -->
        <div id="searchContainer" class="mb-4 d-none">
            <div class="card bg-dark border-secondary p-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" id="playerSearch"
                            class="form-control bg-transparent border-secondary text-white"
                            placeholder="Search by name (e.g. Salah, Bruno)...">
                    </div>
                    <div class="col-md-2">
                        <select id="posFilter" class="form-select bg-transparent border-secondary text-white">
                            <option value="">All Positions</option>
                            <option value="GKP">GKP</option>
                            <option value="DEF">DEF</option>
                            <option value="MID">MID</option>
                            <option value="FWD">FWD</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="sortFilter" class="form-select bg-transparent border-secondary text-white">
                            <option value="total_points">Sort by Points</option>
                            <option value="form">Sort by Form</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-primary w-100" id="executeSearch">
                            <i class="bi bi-search"></i> Discover Players
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Analyzing data streams...</p>
        </div>

        <!-- DASHBOARD CONTENT -->
        <div id="dashboardContent" class="d-none">

            <!-- VIEW: OVERVIEW -->
            <div id="view-overview" class="view-section">
                <!-- KPI Cards -->
                <section class="kpi-section">
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-3">
                            <div class="kpi-card gradient-purple">
                                <div class="kpi-icon"><i class="bi bi-people-fill"></i></div>
                                <div class="kpi-content">
                                    <h3 id="totalPlayers">0</h3>
                                    <p>Total Players</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="kpi-card gradient-blue">
                                <div class="kpi-icon"><i class="bi bi-shield-fill"></i></div>
                                <div class="kpi-content">
                                    <h3 id="totalTeams">0</h3>
                                    <p>Active Teams</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="kpi-card gradient-green">
                                <div class="kpi-icon"><i class="bi bi-trophy-fill"></i></div>
                                <div class="kpi-content">
                                    <h3 id="totalGoals">0</h3>
                                    <p>Goals Tracked</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="kpi-card gradient-orange">
                                <div class="kpi-icon"><i class="bi bi-star-fill"></i></div>
                                <div class="kpi-content">
                                    <h3 id="avgPoints">0</h3>
                                    <p>Avg Points / player</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="row g-4 mt-2">
                    <div class="col-lg-8">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h5><i class="bi bi-graph-up-arrow"></i> Aggregate Points Trend (Gap-Free)</h5>
                            </div>
                            <div class="chart-body" style="height: 350px;"><canvas id="trendChart"></canvas></div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h5><i class="bi bi-pie-chart-fill"></i> Position Distribution</h5>
                            </div>
                            <div class="chart-body" style="height: 350px;"><canvas id="positionChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: DISCOVERY -->
            <div id="view-discovery" class="view-section d-none">
                <div class="chart-card">
                    <div class="chart-header d-flex justify-content-between align-items-center">
                        <h5><i class="bi bi-layers"></i> Global Lookup Results</h5>
                        <small class="text-muted">Enriched with FPL Historical Data</small>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0" id="discoveryTable">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>Total Pts</th>
                                    <th>Per GW</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: TRENDS -->
            <div id="view-trends" class="view-section d-none">
                <div class="row g-4">
                    <div class="col-12">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h5><i class="bi bi-activity"></i> Performance Volatility (G vs A)</h5>
                            </div>
                            <div class="chart-body" style="height: 400px;"><canvas id="goalsAssistsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: TEAMS (SQUAD ANALYTICS) -->
            <div id="view-teams" class="view-section d-none">
                <div class="alert alert-info" id="teamSelectionHint">
                    <i class="bi bi-info-circle"></i> Please select a team from the header dropdown.
                </div>
                <div id="teamSquadContainer" class="d-none">
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="kpi-card bg-primary bg-opacity-25 border border-primary">
                                <div class="kpi-content">
                                    <h3 id="teamTotalPoints">0</h3>
                                    <p class="mb-0">Squad Pts</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h5><i class="bi bi-people"></i> Squad Productivity Matrix</h5>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-dark table-hover mb-0" id="squadTable">
                                <thead>
                                    <tr>
                                        <th>Player</th>
                                        <th>Pts</th>
                                        <th>G/A</th>
                                        <th>Price</th>
                                        <th>Minutes</th>
                                        <th>Points/90</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: STANDINGS -->
            <div id="view-standings" class="view-section d-none">
                <div class="chart-card">
                    <div class="chart-header">
                        <h5><i class="bi bi-list-ol"></i> Performance-Aware League Table</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0" id="standingsTable">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th class="text-start">Team</th>
                                    <th>P</th>
                                    <th>W-D-L</th>
                                    <th>GD</th>
                                    <th>Pts</th>
                                    <th class="row-understat">xG For / Against</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Player Detail Modal -->
    <div class="modal fade" id="playerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content bg-secondary text-white border-0 shadow-lg">
                <div class="modal-header border-secondary p-4">
                    <div>
                        <h4 class="modal-title mb-1" id="playerModalTitle">Player Metrics</h4>
                        <span id="playerModalSubtitle" class="text-muted small">Analytics Engine v2.0</span>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="bg-dark rounded p-3" style="height: 400px;">
                                <canvas id="playerTrendChart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="bg-dark rounded p-4 h-100">
                                <h5>Gameweek Insights</h5>
                                <hr class="border-secondary">
                                <div id="playerStatsDetail" class="small">
                                    <!-- Dynamic stats -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>

</html>